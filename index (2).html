<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Te amo — lluvia infinita</title>
  <meta name="description" content="Una experiencia inmersiva: lluvia de 'te amo' con música de fondo.">
  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; margin: 0; background: #000; }
    body { overflow: hidden; }
    canvas { display: block; width: 100vw; height: 100vh; }
    #ui { position: fixed; inset: 0; pointer-events: none; }
    #controls { position: absolute; right: 16px; bottom: 16px; display: flex; gap: 8px; pointer-events: auto; align-items: center; flex-wrap: wrap; justify-content: flex-end; }
    .btn { appearance: none; border: none; padding: 10px 14px; border-radius: 999px; font: 500 14px/1.1 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: rgba(255, 255, 255, 0.08); color: #fff; backdrop-filter: blur(6px); box-shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.08); cursor: pointer; transition: transform .08s ease; }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .hint { position: absolute; left: 16px; bottom: 16px; color: #b3b3b3; font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial; letter-spacing: .2px; opacity: .9; max-width: 52ch;}
    @media (max-width: 640px) { .hint { display: none; } }
    .slider { -webkit-appearance: none; width: 120px; height: 4px; border-radius: 2px; background: rgba(255,255,255,0.2); outline: none; cursor: pointer; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 14px; height: 14px; border-radius: 50%; background: #fff; cursor: pointer; }
    .slider::-moz-range-thumb { width: 14px; height: 14px; border-radius: 50%; background: #fff; cursor: pointer; }
    #music-controls { position:fixed; top:16px; right:16px; z-index:1000; pointer-events:auto; display:flex; gap:8px; align-items:center; }
    #player { position: absolute; width: 0; height: 0; overflow: hidden; }
    .badge { font-size: 11px; opacity:.8; }
  </style>
</head>
<body>
  <!-- Controles de música (YouTube) -->
  <div id="music-controls">
    <button id="playPauseBtn" class="btn">⏸ Pausar</button>
    <label class="badge" for="volumeControl">Volumen</label>
    <input type="range" id="volumeControl" class="slider" min="0" max="1" step="0.01" value="1" title="Volumen">
  </div>

  <!-- Contenedor requerido por la API de YouTube -->
  <div id="player" aria-hidden="true"></div>

  <canvas id="rain" aria-label="Lluvia de 'te amo'" role="img"></canvas>

  <div id="ui" aria-hidden="true">
    <div class="hint">Consejo: presioná F para alternar pantalla completa. Hacé clic en “Más / menos” para cambiar la cantidad de gotas. ✨</div>
    <div id="controls">
      <button class="btn" id="fullscreenBtn" title="Pantalla completa">Pantalla completa</button>
      <button class="btn" id="densityBtn" title="Cambiar densidad">Más / menos</button>
    </div>
  </div>

  <script>
    // --------- Música de YouTube ---------
    let player;
    const YT_VIDEO_ID = 'nyuo9-OjNNg'; // Lluvia relajante (ejemplo)
    const playPauseBtn = document.getElementById('playPauseBtn');
    const volumeControl = document.getElementById('volumeControl');

    // Cargar la API de YouTube
    (function loadYT() {
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);
    })();

    // La API de YouTube llama a esta función global cuando está lista
    window.onYouTubeIframeAPIReady = function() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: YT_VIDEO_ID,
        playerVars: {
          autoplay: 1,
          loop: 1,
          playlist: YT_VIDEO_ID,
          mute: 1 // Importante para permitir autoplay en móviles/navegadores modernos
        },
        events: {
          onReady: onPlayerReady
        }
      });
    };

    function onPlayerReady() {
      // Sincronizar el slider con el volumen del player (0-100)
      try { volumeControl.value = (player.getVolume() || 100) / 100; } catch (e) {}
      playPauseBtn.addEventListener('click', () => {
        const state = player.getPlayerState();
        if (state === YT.PlayerState.PLAYING) {
          player.pauseVideo();
          playPauseBtn.textContent = '▶️ Reproducir';
        } else {
          // Primera interacción: desmutear si estaba muteado
          if (player.isMuted && player.isMuted()) player.unMute();
          player.playVideo();
          playPauseBtn.textContent = '⏸ Pausar';
        }
      });

      // Control de volumen (0-1 => 0-100)
      volumeControl.addEventListener('input', () => {
        const vol = Math.round(parseFloat(volumeControl.value) * 100);
        try {
          player.setVolume(vol);
          if (player.isMuted && player.isMuted()) player.unMute();
        } catch (e) {}
      }, { passive: true });
    }

    // --------- Lluvia de "te amo" ---------
    (() => {
      const canvas = document.getElementById('rain');
      const ctx = canvas.getContext('2d');

      function resize() {
        const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
        const { innerWidth: w, innerHeight: h } = window;
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      resize();
      addEventListener('resize', resize);

      const WORD = 'te amo';
      const COLORS = ['#ff2d55', '#a64dff'];
      let density = 1.0;

      function makeDrop() {
        const fontSize = Math.random() * 32 + 18;
        const w = canvas.clientWidth;
        const h = canvas.clientHeight;
        return {
          x: Math.random() * w,
          y: Math.random() * -h,
          vy: Math.random() * 1.2 + 0.9,
          speed: (Math.random() * 0.6 + 0.7) * (fontSize / 22),
          fontSize,
          step: fontSize * 1.25,
          colorIndex: Math.random() > 0.5 ? 0 : 1,
          wobble: Math.random() * Math.PI * 2,
          wobbleAmp: Math.random() * 0.6 + 0.2,
          alpha: Math.random() * 0.6 + 0.4
        };
      }

      function computeTargetCount() {
        const area = canvas.clientWidth * canvas.clientHeight;
        return Math.min(1500, Math.max(80, Math.floor(area / 11000 * density)));
      }

      let drops = Array.from({ length: computeTargetCount() }, makeDrop);

      function adjustPopulation() {
        const target = computeTargetCount();
        if (drops.length < target) {
          const toAdd = Math.min(60, target - drops.length);
          for (let i = 0; i < toAdd; i++) drops.push(makeDrop());
        } else if (drops.length > target) {
          drops.length = target;
        }
      }

      const fsBtn = document.getElementById('fullscreenBtn');
      fsBtn.addEventListener('click', () => {
        const el = document.documentElement;
        if (!document.fullscreenElement) el.requestFullscreen?.();
        else document.exitFullscreen?.();
      });
      document.addEventListener('fullscreenchange', () => {
        fsBtn.textContent = document.fullscreenElement ? 'Salir de pantalla completa' : 'Pantalla completa';
      });

      document.getElementById('densityBtn').addEventListener('click', () => {
        density = density >= 1.6 ? 0.7 : density + 0.3;
        adjustPopulation();
      });

      let last = performance.now();
      function tick(now) {
        const dt = Math.min(0.05, (now - last) / 1000);
        last = now;

        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = 'rgba(0,0,0,0.09)';
        ctx.fillRect(0, 0, canvas.clientWidth, canvas.clientHeight);

        for (let i = 0; i < drops.length; i++) {
          const d = drops[i];
          d.y += d.speed + d.vy * 50 * dt;
          d.wobble += dt * 2.0;

          if (d.y - d.step > canvas.clientHeight) {
            drops[i] = makeDrop();
            continue;
          }

          const x = d.x + Math.sin(d.wobble) * d.wobbleAmp * d.fontSize;

          ctx.font = `600 ${d.fontSize}px system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial`;
          ctx.textBaseline = 'top';

          ctx.shadowColor = COLORS[d.colorIndex];
          ctx.shadowBlur = 18;

          d.colorIndex ^= 1;
          ctx.fillStyle = COLORS[d.colorIndex];
          ctx.globalAlpha = d.alpha;
          ctx.fillText(WORD, x, d.y);
          ctx.globalAlpha = 1;
        }

        ctx.globalCompositeOperation = 'lighter';
        adjustPopulation();
        requestAnimationFrame(tick);
      }

      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.clientWidth, canvas.clientHeight);
      requestAnimationFrame(tick);

      window.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'f') fsBtn.click();
      });
    })();
  </script>
</body>
</html>
